(function(){"use strict";importScripts("/dracoCustom/draco_decoder.js");let n="WORKER";const g=self.DracoDecoderModule;let o;const p=g({locateFile:e=>`/dracoCustom/${e}`}).then(e=>{o=e});self.onmessage=async e=>{console.time("Draco"),o||(o=await p);const u=performance.now();console.log(n,"Grabbing the compressed bytes...");const t=new Uint8Array(e.data);console.log(n,`Compressed bytes length: ${t.length}`);const c=o._malloc(t.length),l=o.HEAPU8;l.set(t,c),console.log(n,`Decoding pointcloud with length: ${t.length}`);const s=o._decode_draco(c,t.length);if(o._free(c),s===0)throw new Error("Draco decode failed");const m=o.getValue(s+0,"i32"),y=o.getValue(s+4,"i32"),r=o.getValue(s+8,"i32"),a=l.buffer,w=new Float32Array(a,m,r*3),h=new Uint8Array(a,y,r*3);o._free_pointcloud(s);const i=new Float32Array(w),d=new Uint8Array(h),_=performance.now()-u,f={positions:i,colors:d,numPoints:r,dracoDecodeTime:_};console.log(n,`Sending decoder message: ${f}`),self.postMessage(f,[i.buffer,d.buffer]),console.timeEnd("Draco")}})();
